# Requirements Document

## Introduction

Цей документ описує вимоги до Google Apps Script, який автоматично копіює дані з листа "ЕТС" однієї таблиці в лист "Різниця РЕБ" іншої таблиці з підтримкою об'єднаних ячейок, порівнянням значень та візуальним відображенням змін. Скрипт має запускатися щохвилини та зберігати історію змін з часовими мітками.

## Requirements

### Requirement 1: Автоматичне копіювання даних

**User Story:** Як користувач системи моніторингу, я хочу, щоб дані з листа "ЕТС" автоматично копіювалися в історичну таблицю щодня о 17:00 за київським часом, щоб я міг відстежувати щоденні зміни.

#### Acceptance Criteria

1. WHEN скрипт запускається THEN система SHALL скопіювати весь використаний діапазон з листа "ЕТС" таблиці `1_qqXBn9ke1IQGtC_sA025GPOTgqs96ANJjdnhy9jSWw`
2. WHEN дані копіюються THEN система SHALL вставити їх у лист "Різниця РЕБ" таблиці `1z75tfCOSpwQ3IE5v15aYCLqR2TlnpjOpgiS5eEwAbn0`
3. WHEN скрипт виконується THEN система SHALL додати часову мітку у форматі `dd.MM.yy HH:mm` у стовпець A для кожного блоку даних
4. WHEN створюється тригер THEN система SHALL налаштувати автоматичний запуск щодня о 17:00 за київським часом
5. WHEN скрипт вже виконується THEN система SHALL заблокувати паралельне виконання через LockService

### Requirement 2: Збереження об'єднаних ячейок

**User Story:** Як користувач, я хочу, щоб об'єднані ячейки з вихідної таблиці зберігалися в історії, щоб структура даних залишалася незмінною.

#### Acceptance Criteria

1. WHEN скрипт копіює дані THEN система SHALL визначити всі об'єднані ячейки у вихідному діапазоні
2. WHEN об'єднані ячейки знайдені THEN система SHALL створити відповідні об'єднання в цільовому діапазоні
3. WHEN об'єднання створюється THEN система SHALL зберегти розміри об'єднання (кількість рядків та стовпців)
4. IF вихідна ячейка не об'єднана THEN система SHALL скопіювати її як звичайну ячейку

### Requirement 3: Порівняння значень та візуалізація змін

**User Story:** Як аналітик, я хочу бачити візуальне порівняння нових даних з попередніми, щоб швидко ідентифікувати зростання або зменшення показників.

#### Acceptance Criteria

1. WHEN новий блок даних додається THEN система SHALL знайти попередній блок тієї ж висоти
2. WHEN попередній блок знайдено THEN система SHALL порівняти кожне значення (починаючи з третього стовпця даних)
3. IF значення зросло THEN система SHALL відобразити його як `[число] ↑ +[різниця]` AND підсвітити зеленим кольором `#d4edda`
4. IF значення зменшилося THEN система SHALL відобразити його як `[число] ↓ [різниця]` AND підсвітити червоним кольором `#f8d7da`
5. IF значення не змінилося THEN система SHALL відобразити тільки число без стрілок AND без підсвітки
6. WHEN порівнюються дані THEN система SHALL НЕ порівнювати перші два стовпці даних (індекси 0 та 1 у масиві)
7. IF це перший блок даних THEN система SHALL вставити дані без порівняння та підсвітки

### Requirement 4: Форматування процентних значень

**User Story:** Як користувач, я хочу, щоб процентні значення відображалися з символом % та двома знаками після коми, щоб дані були зрозумілими.

#### Acceptance Criteria

1. WHEN система обробляє останній стовпець діапазону THEN система SHALL розпізнати його як процентний
2. WHEN значення форматується як процент THEN система SHALL відобразити його з двома знаками після коми AND додати символ `%`
3. WHEN порівнюються процентні значення THEN система SHALL використовувати ту ж логіку форматування для різниці
4. IF стовпець не є процентним THEN система SHALL відобразити значення як ціле число

### Requirement 5: Обробка числових значень

**User Story:** Як розробник, я хочу використовувати існуючу логіку обробки чисел, щоб забезпечити сумісність з поточною системою.

#### Acceptance Criteria

1. WHEN система обробляє значення THEN система SHALL використовувати функцію `toNum()` для конвертації
2. WHEN значення форматується THEN система SHALL використовувати функцію `formatVal()`
3. WHEN шукається попередній блок THEN система SHALL використовувати функцію `findPrevBlockTop()`
4. WHEN перевіряється часова мітка THEN система SHALL використовувати функцію `isDateStamp()`
5. WHEN функції викликаються THEN система SHALL НЕ змінювати їх внутрішню логіку

### Requirement 6: Копіювання форматування

**User Story:** Як користувач, я хочу, щоб разом з даними копіювалося їх форматування, щоб історичні записи виглядали так само, як оригінал.

#### Acceptance Criteria

1. WHEN дані копіюються THEN система SHALL скопіювати кольори шрифту
2. WHEN дані копіюються THEN система SHALL скопіювати розміри шрифту
3. WHEN дані копіюються THEN система SHALL скопіювати жирність та курсив шрифту
4. WHEN дані копіюються THEN система SHALL скопіювати горизонтальне та вертикальне вирівнювання
5. WHEN дані копіюються THEN система SHALL скопіювати стратегію переносу тексту
